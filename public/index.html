<!DOCTYPE html>
<html lang="en" dir="auto">

<head>
	<meta name="generator" content="Hugo 0.133.0"><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>momo blog</title>

<meta name="description" content="">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.8f541c169a12d0d6bb704527bb78f6481fb4f5a39b7171fc16fab8c03ae6b1bd.css" integrity="sha256-j1QcFpoS0Na7cEUnu3j2SB&#43;09aObcXH8Fvq4wDrmsb0=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/index.xml">
<link rel="alternate" hreflang="en" href="http://localhost:1313/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  

<meta property="og:title" content="momo blog" />
<meta property="og:description" content="" />
<meta property="og:type" content="website" />
<meta property="og:url" content="http://localhost:1313/" />
<meta property="og:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta property="og:site_name" content="momo blog" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="http://localhost:1313/images/papermod-cover.png" />
<meta name="twitter:title" content="momo blog"/>
<meta name="twitter:description" content=""/>

<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "momo blog",
  "url": "http://localhost:1313/",
  "description": "",
  "thumbnailUrl": "http://localhost:1313/favicon.ico",
  "sameAs": [
      "https://gitee.com/Eleutheria666", "https://instagram.com/", "https://twitter.com/", "https://ko-fi.com"
  ]
}
</script>
</head>

<body class="list" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="momo blog (Alt + H)">momo blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/archives/" title="archives">
                    <span>archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="categories">
                    <span>categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="tags">
                    <span>tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="search (Alt &#43; /)" accesskey=/>
                    <span>search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<article class="first-entry home-info">
    <header class="entry-header">
        <h1>Momo&rsquo;s Blog</h1>
    </header>
    <div class="entry-content">
        Welcome to my blog page!
    </div>
    <footer class="entry-footer">
        <div class="social-icons" >
    <a href="https://gitee.com/Eleutheria666" target="_blank" rel="noopener noreferrer me"
        title="Github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22">
    </path>
</svg>
    </a>
    <a href="https://instagram.com/" target="_blank" rel="noopener noreferrer me"
        title="Instagram">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
    <line x1="17.5" y1="6.5" x2="17.5" y2="6.5"></line>
</svg>
    </a>
    <a href="https://twitter.com/" target="_blank" rel="noopener noreferrer me"
        title="Twitter">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
    stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z">
    </path>
</svg>
    </a>
    <a href="https://ko-fi.com" target="_blank" rel="noopener noreferrer me"
        title="Buy Me a Ko-Fi :)">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 -3 23 27" preserveAspectRatio="xMidYMid meet" fill="none"
    stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
    <path
        d="M23.881 8.948c-.773-4.085-4.859-4.593-4.859-4.593H.723c-.604 0-.679.798-.679.798s-.082 7.324-.022 11.822c.164 2.424 2.586 2.672 2.586 2.672s8.267-.023 11.966-.049c2.438-.426 2.683-2.566 2.658-3.734c4.352.24 7.422-2.831 6.649-6.916zm-11.062 3.511c-1.246 1.453-4.011 3.976-4.011 3.976s-.121.119-.31.023c-.076-.057-.108-.09-.108-.09c-.443-.441-3.368-3.049-4.034-3.954c-.709-.965-1.041-2.7-.091-3.71c.951-1.01 3.005-1.086 4.363.407c0 0 1.565-1.782 3.468-.963c1.904.82 1.832 3.011.723 4.311zm6.173.478c-.928.116-1.682.028-1.682.028V7.284h1.77s1.971.551 1.971 2.638c0 1.913-.985 2.667-2.059 3.015z" />
</svg>
    </a>
</div>

    </footer>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Lab9: file system
    </h2>
  </header>
  <div class="entry-content">
    <p>Lab链接：Lab: file system (mit.edu)
Lab源码：momo/MIT-6S081/fs - Gitee.com
1 Large files 题目 当前xv6文件最大只能存储268 blocks的数据。你的任务是修改xv6的代码，将inode结点中的一个“直接索引”改为“二级索引”：该索引指向的block包含256个间接block的地址，每个间接block又包含256个数据block的地址，以扩大文件可存储数据的容量。
思路 将struct inode中的NDIRECT直接索引的盘块号减一，腾出一个索引用于二级索引，其他变量随之改动。此时 struct dinode和struct inode的addrs数组大小应为[NDIRECT&#43;2]
1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // kernel/fs.h #define NDIRECT 11 // 12-&gt;11 #define NINDIRECT (BSIZE / sizeof(uint)) #define NDOUBLEINDIRECT (NINDIRECT*NINDIRECT) #define MAXFILE (NDIRECT &#43; NINDIRECT &#43; NDOUBLEINDIRECT) struct dinode { // ... uint addrs[NDIRECT&#43;2]; // [NDIRECT&#43;1] -&gt; [NDIRECT&#43;2] }; struct inode { // ....</p>
  </div>
  <footer class="entry-footer"><span title='2024-10-20 00:00:00 +0000 UTC'>October 20, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;419 words</footer>
  <a class="entry-link" aria-label="post link to Lab9: file system" href="http://localhost:1313/posts/mit6.s081/lab9-file-system/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Lab8: locks
    </h2>
  </header>
  <div class="entry-content">
    <p>Lab链接：Lab: locks
Lab源码：momo/MIT-6S081/lock - Gitee.com
1 Memory allocator✅ 题目 当前xv6，不同CPU核调用kalloc/kfree函数都是针对同一内存空间进行操作。为了保证数据的一致性，调用kalloc/kfree需要先获取kmem.lock锁。但是这个锁的颗粒度较大，锁住的是所有可分配的内存空间，这样会导致更多CPU竞争这个锁，更多的线程因为无法获取锁而原地等待，不能及时获取/回收相应的内存空间。
你的任务是缩小锁的颗粒度，基本思想是为每个CPU维护一个空闲列表，每个列表都有自己的锁。这样不同CPU上的分配和释放可以并行运行，不会产生锁争用，因为每个CPU将在不同的列表上运行。
若一个CPU的空闲列表为空，在这种情况下，通过“窃取”另一个CPU空闲列表的一部分进行分配，这会引入锁争用，但很少发生。
思路 创建一个长度为NCPU的kmem列表，列表的每一项对应一个CPU，包含了锁核空闲列表的头节点 kinit初始化内存空间时，对于每一个CPU，只能在【end&#43;id*INTERVAL，end&#43;id*INTERVAL&#43;PGSIZE】分配内存，所以freerange()的范围为【end&#43;id*INTERVAL，end&#43;id*INTERVAL&#43;PGSIZE】 对于kfree函数，如果当前释放的地址pa不属于该CPU可控的内存空间之内，则通过pa定位当前该物理地址所属的CPU 对于kalloc函数，如果当前CPU的空闲列表为0，则遍历所有CPU，从第一个空闲列表不为空的CPU所控制的内存区域进行分配 通过减少锁锁住的共享资源，减少锁竞争的概率，从而提高执行效率，实现锁的优化。
2 Buffer cache❌ 这个实验目标是对XV6的磁盘缓冲区进行优化。初始的XV6磁盘缓冲区中是使用一个LRU链表来维护的，而这就导致了每次获取、释放缓冲区时就要对整个链表加锁，也就是说缓冲区的操作是完全串行进行的。</p>
  </div>
  <footer class="entry-footer"><span title='2024-10-11 00:00:00 +0000 UTC'>October 11, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;22 words</footer>
  <a class="entry-link" aria-label="post link to Lab8: locks" href="http://localhost:1313/posts/mit6.s081/lab8-lock/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Lab6: multithreading
    </h2>
  </header>
  <div class="entry-content">
    <p>Lab链接：Lab: Multithreading
Lab源码：momo/MIT-6S081/thread - Gitee.com
1 Uthread: switching between threads⭕ 题目 当前xv6的线程切换需要用户线程进入内核空间后，再调用CPU调度器线程完成线程切换。
本lab需要你在用户空间完成线程切换。
思路 Q：为什么只需要保存callee-saved register？
A：调用swtch()前会保存caller-saved reg至栈帧，而swtch()是callee，该函数需保存callee-saved reg。对于trapframe，由于系统会在用户进程不经意间打断，所以需要保存所有的寄存器
栈从高地址到低地址增长，因此初始化线程的sp指针应该是stack&#43;STACK_SIZE-1
2 Using threads​​ 3 Barrier​​ 实现多个线程的同步。</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-28 00:00:00 +0000 UTC'>September 28, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;26 words</footer>
  <a class="entry-link" aria-label="post link to Lab6: multithreading" href="http://localhost:1313/posts/mit6.s081/lab6-multithreading/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Lab5: copy on Write
    </h2>
  </header>
  <div class="entry-content">
    <p>Lab链接：Lab: Copy-on-Write Fork for xv6
Lab源码：momo/MIT-6S081/cow - Gitee.com
基于Page faults的附加功能 恢复page fault中断 恢复page fault，需要三个要素：
引起page fault的虚拟地址（STVAL） 引起page fault原因的类型（SCAUSE） 发生page fault时程序计数器值，即造成page fault的指令在用户虚拟空间的位置（SEPC） 理想情况下，操作系统应能够在发生page fault中断时，对其进行响应的处理，继续运行后续指令
Lazy page allocation
eager allocation：一旦调用了sbrk，内核会立即分配应物理内存。但会存在过多申请的内存过少使用的情况。
lazy allocation：sbrk系统调不做任何事情，唯一需要做的事情就是提升p-&gt;sz，将p-&gt;sz增加n，其中n是需要新分配的内存page数量。但是内核在这个时间点并不会分配任何物理内存。之后某个时间点程序使用到了新申请的那部分内存，会触发page fault，因为我们还没有分配实际的物理内存（即新的内存未映射到page table）。所以，当我们看到了一个page fault，相应的虚拟地址小于当前p-&gt;sz，同时大于stack，那么我们就知道这是一个来自于heap的地址，但是内核还没有分配任何物理内存。
Copy on write fork 调用fork时，先创建4个新的page，再将父进程page的内容拷贝至4个新的分配给子进程的page中。
之后调用exec又会释放这些page，并分配新的page来包含echo相关的内容。
优化：创建子进程时，与其创建分配拷贝内容到新的物理内存，不如直接共享父进程的物理内存page并设置子进程的PTE指向父进程对应的物理内存page。但是父进程和子进程之间的隔离性，要保证：子进程对这些内存的修改应该对父进程不可见，所以这里的父进程和子进程的PTE的标志位都设置成只读的。
父进程和子进程继续运行，当父进程或子进程执行store指令更新一些全局变量时会触发page fault，因为现在在向一个只读PTE写数据。
在得到page fault之后，先分配一个新的page，然后将父进程相应的page拷贝到新page，并将新page映射到子进程的页表中。这时，新分配的page只对子进程可见，相应的PTE设置成可读写，并且重新执行指令。对于触发page fault对应的物理page，因为现在只对父进程可见，相应的PTE对于父进程也变成可读写的了。
释放：当我们释放page时，我们将物理内存page的引用数减1。只有引用数为0时释放物理内存page。
Least Recently Used（LRU) 应用程序启动时，不会把全部指令加载到内存，也不会分配远超于需要的data内存区域。
回收：当系统发生OOM，物理内存耗尽时，将部分内存page中的内容写回到文件系统再收回这个page
回收哪些page：access位为0，回收最近未被访问过的page。此外，dirty位为0，表明当前page被修改过
Memory Mapped Files memory mapped files：将完整或者部分文件加载到内存中，这样就可以通过内存地址相关的load或者store指令来操纵文件。
mmap系统调用：虚拟内存地址，长度，protection，标志位，一个打开的文件描述符，偏移量。从文件描述符对应的文件的偏移量位置开始，映射长度为len的内容到虚拟内存地址VA，同时加上一些保护，比如只读或者读写。
mmap系统调用的过程：先记录一下这个PTE属于这个文件描述符。相应的信息保存在VMA结构体（Virtual Memory Area）。例如对于这里的文件f，会有一个VMA，在VMA中我们会记录文件描述符，偏移量等等，这些信息用来表示对应的内存虚拟地址的实际内容在哪，这样当我们得到一个位于VMA地址范围的page fault时，内核可以从磁盘中读数据，并加载到内存中。
1 Implement copy-on write xv6 中fork系统调用会将父进程的所有内存数据复制给子进程。若父进程内存占用大，复制耗时久，且若子进程后续执行exec，复制的内存大概率被丢弃，造成资源浪费。
copy-on write机制直到父子进程中的一方需写入页面时才进行实际的复制操作，以此提升系统效率 。</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-21 00:00:00 +0000 UTC'>September 21, 2024</span>&nbsp;·&nbsp;1 min&nbsp;·&nbsp;72 words</footer>
  <a class="entry-link" aria-label="post link to Lab5: copy on Write" href="http://localhost:1313/posts/mit6.s081/lab5-copy-on-write/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Lab4: traps
    </h2>
  </header>
  <div class="entry-content">
    <p>Lab链接：Lab: Traps
Lab源码：momo/MIT-6S081/traps - Gitee.com
用户态切换为内核态发生在以下情形：
系统调用 软件运行错误：page fault 设备发出中断 用户内核态的切换，要让硬件从适合用户程序运行的状态转化为适合内核程序运行的状态，包括：
保存32个用户寄存器：内核会使用寄存器，用户程序在寄存器中的值不能被破坏 保存程序计数器：内核程序执行完毕后能够从用户程序中断的位置继续执行 改为supervisor mode：在内核中需要执行特权指令 SATP寄存器从user page table改为kernel page table 堆栈寄存器指向内核地址 相比用户态，内核态增加了以下权限：
读写控制寄存器 使用PTE_U为0的页表：PTE_U设置为1用户态可使用 trapoline页表在用户和内核页表虚拟地址一致，映射的都是同一个物理页
trapframe用于保存进程在用户态的相关数据，而context用于保存进程在内核态相关数据
用户态➡内核态 用户进程调用fork系统调用，实际执行如下指令：
1 2 3 4 5 .global fork fork: li a7, SYS_fork ecall ret 向a7寄存器写入系统调用编号 执行ecall指令，该指令在硬件层面完成： 切换为supervisor mode 进入中断处理程序：PC➡SEPC，STVEC➡PC（STVEC事先保存了中断处理程序uservec的地址） 此时进入中断处理程序uservec（此时未切换page table，虽进入内核态但仍使用用户态的页表）
保存用户态通用寄存器，用于中断后恢复上下文：sscratch 寄存器事先存储了p-&gt;trapframe ，交换 a0 和 sscratch 的值，使得 a0 指向进程trapframe的首地址 加载内核态上下文：栈指针、内核页表、从 TRAPFRAME 中读取 usertrap() 函数的地址，并将其加载到 t0 寄存器 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 ....</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-14 00:00:00 +0000 UTC'>September 14, 2024</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;1110 words</footer>
  <a class="entry-link" aria-label="post link to Lab4: traps" href="http://localhost:1313/posts/mit6.s081/lab4-trap/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Lab3: page tables
    </h2>
  </header>
  <div class="entry-content">
    <p>Lab链接：Lab: page tables
Lab源码：momo/MIT-6S081/pgtbl - Gitee.com
xv6的页表机制 xv6采用64位地址，一页大小为4KB(4096B)
xv6的页表项（64位）
页表项代表的页的物理地址（10~53） 页表的操作权限（0~9） xv6的虚拟地址（64位）➡物理地址转换
一级页表L2&#43;二级页表L1&#43;三级页表L0&#43;三级页表中的偏移量Offset（9&#43;9&#43;9&#43;12）
内核拥有自己的页表。当进程进入内核态时，操作系统将内核根页表存入页表基地址寄存器；进程退出内核态时切换回进程根页表。
进程在内核态执行程序时，使用内核根页表找到内核程序中虚拟地址对应的物理地址。
xv6内核视角下，虚拟地址与物理地址对应关系 低于0x80000000：分配给I/O设备，作为外部设备的寄存器
direct mapping memory-mapped：内核处理这个范围的虚拟地址时直接定位对应的物理地址，即外部设备接口，不需要通过RAM访问外部设备。 0x80000000~PHYSTOP（0x86400000）：存储内核程序、数据
kernel text：内核代码，R-X，direct mapping kernel data：RW-，防止恶意程序写入kernel data并执行 kernel stack：系统会为每个进程分配一页保护页（Guard page）以及一页内核栈（Kstack）。保护页有效位被设置为 0 ，并且不分配对应的物理页。Kstack发生溢出，数据试图进入Guard page，由于Guard page无法转换为有效的物理地址，会触发缺页异常（page fault） trampoline：RX-， xv6内核启动（kernel/main.c），创建内核页表：
申请一个空页表 关联IO设备的地址 关联内核程序，内核程序已成功加载到物理地址范围为 KERNBASE 至 exect 的区域，起始虚拟地址设定为 KERNBASE 关联trampoline 从最高虚拟地址往下，为每个进程分配一个内核栈页 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 #define TRAMPOLINE (MAXVA - PGSIZE) #define KERNBASE 0x80000000L #define PHYSTOP (KERNBASE &#43; 128*1024*1024) extern char trampoline[]; // trampoline....</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-07 00:00:00 +0000 UTC'>September 7, 2024</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;1376 words</footer>
  <a class="entry-link" aria-label="post link to Lab3: page tables" href="http://localhost:1313/posts/mit6.s081/lab3-page-tables/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Lab2: system calls
    </h2>
  </header>
  <div class="entry-content">
    <p>Lab链接：Lab: System calls
Lab源码：momo/MIT-6S081/syscall - Gitee.com
1 System call tracing 在操作系统开发与调试过程中，对程序进行系统调用进行跟踪有助于深入了解程序运行时的系统行为
题目 创建一个新的系统调用 trace ，该系统调用接收一个整数参数 mask 。通过对 mask 二进制位的设置，指定需要跟踪的系统调用。例如，若要跟踪 fork 系统调用，程序需调用 trace(1 &lt;&lt; SYS_fork) ，其中 SYS_fork 是在 kernel/syscall.h 中定义系统调用编号。当每个系统调用即将返回时，若该系统调用的编号在 mask 中被设置，则打印一行信息，包含进程 ID、系统调用名称以及返回值，无需打印系统调用的参数。
trace 系统调用应仅对调用它的进程及其后续通过 fork 创建的子进程启用跟踪功能，而不影响其他进程。
（一）部分系统调用跟踪
执行 trace 32 grep hello README ，其中 32 对应 1&lt;&lt;SYS_read ，表示仅跟踪 grep 执行过程中 read 系统调用，输出：
1 2 3 4 3: syscall read -&gt; 1023 3: syscall read -&gt; 966 3: syscall read -&gt; 70 3: syscall read -&gt; 0 （二）全系统调用跟踪...</p>
  </div>
  <footer class="entry-footer"><span title='2024-09-01 00:00:00 +0000 UTC'>September 1, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;545 words</footer>
  <a class="entry-link" aria-label="post link to Lab2: system calls" href="http://localhost:1313/posts/mit6.s081/lab2-system-calls/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Chapter 4. Expressions
    </h2>
  </header>
  <div class="entry-content">
    <p>4.2 算术运算符 算术运算符包含以下3种类型，按优先级从高到低排序：
&#43;、- ：一元正号与一元负号 *、/、% ：乘法、除法、求余 &#43;、- ：加法、减法 当算数操作符是布尔类型时，会将布尔变量转化为int类型进行运算（true为1，false为0）。当算数操作符运算的数字结果赋值给布尔变量时，会将算术类型转化为布尔类型（0为false，其他为true）
除法运算如果两个操作数均为整数，结果是向零舍入
求余运算符的运算对象必须是整数，运算结果始终与被除数符号相同
编译器和运行期间没有对运算溢出错误的警告，当发生溢出时，会产生不可预知的行为。
4.3 逻辑关系运算符 逻辑运算符：！、&amp;&amp;、||。逻辑运算符的作用对象必须是能转换成布尔值的类型 关系运算符：&lt;, &lt;=, &gt;, &gt;=, !=, == ：大于小于的优先级高于等于和不等于 以下值转化为布尔类型的结果为false：
算术类型：int num = 0
指针类型：int *p = 0
字符类型：char ch = &#39;\0&#39;
以算数值作为if判断条件：直接用，不要与布尔值做比较
布尔字面量true和false只适用于和布尔变量进行比较
1 2 if(a); //正确 if(a == true); //错误：会将 true 先转换为 int 再比较，比较结果是不相等 4.5 递增递减运算符 前置版本&#43;&#43;i：首先将运算对象加 1，然后将改变后的对象作为求值结果，返回对象本身作为左值
后置版本i&#43;&#43;：也是将运算对象加 1，但结果是运算对象改变之前那个值的副本，返回将对象原始值的副本
如无必要，不要使用后置版本：前置版本直接返回改变了的运算对象，后置版本需要将原始值保存下来以便于返回，是一种浪费。后置版本对于整数和指针来说影响不大，对于迭代器而言消耗巨大。
提倡一种写法：*p&#43;&#43;：
由于递增运算符优先级高于解引用，所以先进行递增运算：先将p值加一，然后返回p的初始值的副本作为求值结果用于解引用
1 2 3 auto pbeg = v.begin(); while(pbeg != v.end()) cout &lt;&lt; *pbeg&#43;&#43; &lt;&lt; endl; 练习 *beg作为左值时已经&#43;1...</p>
  </div>
  <footer class="entry-footer"><span title='2024-08-28 00:00:00 +0000 UTC'>August 28, 2024</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;754 words</footer>
  <a class="entry-link" aria-label="post link to Chapter 4. Expressions" href="http://localhost:1313/posts/c&#43;&#43;-primer/ch04/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Chapter 3. Strings, Vectors, and Arrays
    </h2>
  </header>
  <div class="entry-content">
    <p>3.1 String 使用字符串字面值或字符数组初始化 string 对象时，string 不包含末尾的空字符。
3.1.1 输入输出 cin &gt;&gt; string
cin自动忽略开头的空白，遇到空白停止读取，返回true 当cin输入错误或到达输入流末尾，返回false 1 2 3 4 5 6 int main() { string word; while (cin &gt;&gt; word) // read until end-of-file cout &lt;&lt; word &lt;&lt; endl; // write each word followed by a new line return 0; } getline(cin, string)
定义在头文件 string 中，以一个 istream 对象和一个 string 对象为输入参数 getline读取输入流直到遇到换行符停止，然后将读入的数据存入 string 对象，适用于读取一行 getline也会读入换行符，但是不将换行符存入 string 对象：若只输入一个换行符，读取的结果为空字符串 getline读取为止 1 2 3 4 5 6 int main() { string line; // read input a line at a time until end-of-file while (getline(cin, line)) cout &lt;&lt; line &lt;&lt; endl; } 3....</p>
  </div>
  <footer class="entry-footer"><span title='2024-08-27 00:00:00 +0000 UTC'>August 27, 2024</span>&nbsp;·&nbsp;2 min&nbsp;·&nbsp;305 words</footer>
  <a class="entry-link" aria-label="post link to Chapter 3. Strings, Vectors, and Arrays" href="http://localhost:1313/posts/c&#43;&#43;-primer/ch03/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Chapter 2. Variables and Basic Types
    </h2>
  </header>
  <div class="entry-content">
    <p>2.1 内置类型 2.1.1 基本内置类型 C&#43;&#43; 定义了各类型的最小尺寸：bool 未定义、char 8位、short 16位、int 16位、long 32位、long long 64位
类型选择：
明确知晓数值不可能为负时，选用无符号类型
整数运算用 int，数值太大时用 long long，不用 short 和 long
2.1.2 类型转换 1 2 3 4 5 6 bool b = 42; // b is true int i = b; // i has value 1 i = 3.14; // i has value 3 double pi = i; // pi has value 3.0 unsigned char c = -1; // assuming 8-bit chars, c has value 255 signed char c2 = 256; // assuming 8-bit chars, the value of c2 is undefined 几种自动转换情况：...</p>
  </div>
  <footer class="entry-footer"><span title='2024-08-25 00:00:00 +0000 UTC'>August 25, 2024</span>&nbsp;·&nbsp;9 min&nbsp;·&nbsp;1844 words</footer>
  <a class="entry-link" aria-label="post link to Chapter 2. Variables and Basic Types" href="http://localhost:1313/posts/c&#43;&#43;-primer/ch02/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="next" href="http://localhost:1313/page/2/">Next&nbsp;2/2&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">momo blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
